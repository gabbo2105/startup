<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hotel Supply Pro</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    /* ============ CSS VARIABLES ============ */
    :root {
      --bg-primary: #0b1120;
      --bg-secondary: #111827;
      --bg-tertiary: #1a2332;
      --bg-input: #0f1729;
      --border-color: #1e293b;
      --border-hover: #334155;

      --text-primary: #f1f5f9;
      --text-secondary: #94a3b8;
      --text-muted: #64748b;

      --brand: #d4802a;
      --brand-hover: #e8943a;
      --brand-light: #f5a623;
      --brand-subtle: rgba(212, 128, 42, 0.12);
      --brand-glow: rgba(212, 128, 42, 0.2);

      --danger: #ef4444;
      --success: #22c55e;

      --font-display: 'Playfair Display', Georgia, 'Times New Roman', serif;
      --font-body: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;

      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 16px;
      --radius-xl: 24px;
      --radius-full: 9999px;

      --transition-fast: 150ms ease;
      --transition-normal: 250ms ease;

      --header-height: 64px;
      --input-bar-height: 80px;
    }

    /* ============ RESET ============ */
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
    }

    body {
      font-family: var(--font-body);
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow-x: hidden;
    }

    /* ============ GRAIN TEXTURE ============ */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      opacity: 0.035;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
      pointer-events: none;
      z-index: 0;
    }

    /* ============ GLOBAL ============ */
    .page {
      position: relative;
      z-index: 1;
      min-height: 100vh;
    }

    h1, h2, h3, h4 {
      font-family: var(--font-display);
      font-weight: 600;
      line-height: 1.3;
    }

    a {
      color: var(--brand);
      text-decoration: none;
      transition: color var(--transition-fast);
    }

    a:hover {
      color: var(--brand-hover);
    }

    /* ============ BUTTONS ============ */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
      font-family: var(--font-body);
      font-size: 0.95rem;
      font-weight: 600;
      border: none;
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all var(--transition-fast);
      text-decoration: none;
      line-height: 1.4;
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .btn-primary {
      background: var(--brand);
      color: #fff;
    }

    .btn-primary:hover:not(:disabled) {
      background: var(--brand-hover);
      box-shadow: 0 0 20px var(--brand-glow);
    }

    .btn-secondary {
      background: transparent;
      color: var(--text-primary);
      border: 1px solid var(--border-color);
    }

    .btn-secondary:hover:not(:disabled) {
      border-color: var(--border-hover);
      background: var(--bg-tertiary);
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-secondary);
      padding: 0.5rem 0.75rem;
    }

    .btn-ghost:hover:not(:disabled) {
      color: var(--text-primary);
      background: var(--bg-tertiary);
    }

    .btn-lg {
      padding: 1rem 2rem;
      font-size: 1.05rem;
      border-radius: var(--radius-lg);
    }

    /* ============ FORM INPUTS ============ */
    .form-group {
      margin-bottom: 1.25rem;
    }

    .form-label {
      display: block;
      font-size: 0.85rem;
      font-weight: 500;
      color: var(--text-secondary);
      margin-bottom: 0.4rem;
    }

    .form-input {
      width: 100%;
      padding: 0.75rem 1rem;
      font-family: var(--font-body);
      font-size: 0.95rem;
      color: var(--text-primary);
      background: var(--bg-input);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      outline: none;
      transition: all var(--transition-fast);
    }

    .form-input::placeholder {
      color: var(--text-muted);
    }

    .form-input:focus {
      border-color: var(--brand);
      box-shadow: 0 0 0 3px var(--brand-subtle);
    }

    .form-section-title {
      font-family: var(--font-display);
      font-size: 1.05rem;
      font-weight: 600;
      color: var(--brand-light);
      margin-bottom: 1rem;
      margin-top: 1.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--border-color);
    }

    .form-section-title:first-child {
      margin-top: 0;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    .form-error {
      color: var(--danger);
      font-size: 0.85rem;
      margin-top: 0.75rem;
      min-height: 1.2em;
    }

    .form-link {
      text-align: center;
      margin-top: 1.5rem;
      font-size: 0.9rem;
      color: var(--text-secondary);
    }

    /* ============ LANDING PAGE ============ */
    .landing-nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 2rem;
      max-width: 1200px;
      margin: 0 auto;
    }

    .logo {
      font-family: var(--font-display);
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--text-primary);
    }

    .logo-accent {
      color: var(--brand);
    }

    .nav-actions {
      display: flex;
      gap: 0.75rem;
    }

    .hero {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      min-height: calc(100vh - 80px);
      padding: 2rem;
    }

    .hero-badge {
      display: inline-block;
      padding: 0.4rem 1rem;
      font-size: 0.8rem;
      font-weight: 600;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      color: var(--brand);
      background: var(--brand-subtle);
      border: 1px solid rgba(212, 128, 42, 0.2);
      border-radius: var(--radius-full);
      margin-bottom: 1.5rem;
    }

    .hero h1 {
      font-size: 3.5rem;
      font-weight: 700;
      line-height: 1.15;
      margin-bottom: 1.25rem;
      max-width: 700px;
    }

    .hero h1 .brand-text {
      color: var(--brand);
    }

    .hero .subtitle {
      font-size: 1.2rem;
      color: var(--text-secondary);
      max-width: 550px;
      margin-bottom: 0.75rem;
    }

    .hero .sub-detail {
      font-size: 1rem;
      color: var(--text-muted);
      margin-bottom: 2.5rem;
    }

    .hero-cta {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      justify-content: center;
    }

    .features {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1.5rem;
      max-width: 1000px;
      margin: 0 auto;
      padding: 0 2rem 4rem;
    }

    .feature-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      padding: 1.75rem;
      transition: all var(--transition-normal);
    }

    .feature-card:hover {
      border-color: var(--border-hover);
      transform: translateY(-2px);
    }

    .feature-icon {
      font-size: 2rem;
      margin-bottom: 1rem;
    }

    .feature-card h3 {
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
    }

    .feature-card p {
      font-size: 0.9rem;
      color: var(--text-secondary);
    }

    .landing-footer {
      text-align: center;
      padding: 2rem;
      color: var(--text-muted);
      font-size: 0.85rem;
      border-top: 1px solid var(--border-color);
    }

    /* ============ AUTH PAGES ============ */
    .auth-container {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 2rem;
    }

    .auth-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-xl);
      padding: 2.5rem;
      width: 100%;
      max-width: 460px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    .auth-card--wide {
      max-width: 560px;
    }

    .auth-header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .auth-header .logo {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
    }

    .auth-header p {
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    /* ============ DASHBOARD ============ */
    #page-dashboard {
      display: flex;
      flex-direction: column;
      height: 100vh;
      min-height: 0;
    }

    .dashboard-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: var(--header-height);
      padding: 0 1.25rem;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-color);
      flex-shrink: 0;
      z-index: 10;
    }

    .dashboard-header-left {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      min-width: 0;
    }

    .dashboard-header-left .logo {
      font-size: 1.1rem;
      white-space: nowrap;
    }

    .header-hotel-name {
      font-size: 0.85rem;
      color: var(--text-secondary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .header-separator {
      width: 1px;
      height: 24px;
      background: var(--border-color);
      flex-shrink: 0;
    }

    .dashboard-header-right {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .chat-area {
      flex: 1;
      overflow-y: auto;
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .chat-messages {
      max-width: 800px;
      width: 100%;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    /* ============ CHAT MESSAGES ============ */
    .chat-message {
      display: flex;
      max-width: 100%;
    }

    .chat-message.msg-user {
      justify-content: flex-end;
    }

    .chat-message.msg-assistant {
      justify-content: flex-start;
    }

    .msg-bubble {
      max-width: 75%;
      padding: 0.85rem 1.1rem;
      font-size: 0.95rem;
      line-height: 1.55;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }

    .msg-bubble--user {
      background: var(--brand-subtle);
      border: 1px solid rgba(212, 128, 42, 0.2);
      border-radius: var(--radius-lg) var(--radius-lg) var(--radius-sm) var(--radius-lg);
      color: var(--text-primary);
    }

    .msg-bubble--assistant {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg) var(--radius-lg) var(--radius-lg) var(--radius-sm);
      color: var(--text-primary);
    }

    .msg-bubble--assistant strong {
      color: var(--brand-light);
    }

    /* ============ TYPING INDICATOR ============ */
    .typing-indicator {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 1rem 1.2rem !important;
    }

    .typing-indicator span {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--text-muted);
      animation: typing-bounce 1.4s infinite ease-in-out both;
    }

    .typing-indicator span:nth-child(2) {
      animation-delay: 0.16s;
    }

    .typing-indicator span:nth-child(3) {
      animation-delay: 0.32s;
    }

    @keyframes typing-bounce {
      0%, 80%, 100% {
        transform: scale(0.6);
        opacity: 0.4;
      }
      40% {
        transform: scale(1);
        opacity: 1;
      }
    }

    /* ============ SUGGESTION CHIPS ============ */
    .suggestion-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      max-width: 800px;
      margin: 0 auto;
      padding: 0.25rem 0;
    }

    .suggestion-chip {
      display: inline-block;
      padding: 0.5rem 1rem;
      font-family: var(--font-body);
      font-size: 0.85rem;
      color: var(--text-secondary);
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-full);
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .suggestion-chip:hover {
      color: var(--brand);
      border-color: var(--brand);
      background: var(--brand-subtle);
    }

    /* ============ CHAT INPUT BAR ============ */
    .chat-input-bar {
      flex-shrink: 0;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 1rem 1.5rem;
      background: var(--bg-secondary);
      border-top: 1px solid var(--border-color);
    }

    .chat-input-bar .input-wrapper {
      flex: 1;
      max-width: 800px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      background: var(--bg-input);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      padding: 0.25rem 0.25rem 0.25rem 1rem;
      transition: border-color var(--transition-fast);
    }

    .chat-input-bar .input-wrapper:focus-within {
      border-color: var(--brand);
      box-shadow: 0 0 0 3px var(--brand-subtle);
    }

    .chat-input-bar input {
      flex: 1;
      background: transparent;
      border: none;
      outline: none;
      font-family: var(--font-body);
      font-size: 0.95rem;
      color: var(--text-primary);
      padding: 0.5rem 0;
    }

    .chat-input-bar input::placeholder {
      color: var(--text-muted);
    }

    .chat-send-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      background: var(--brand);
      border: none;
      border-radius: var(--radius-md);
      color: #fff;
      cursor: pointer;
      transition: all var(--transition-fast);
      flex-shrink: 0;
    }

    .chat-send-btn:hover:not(:disabled) {
      background: var(--brand-hover);
    }

    .chat-send-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .chat-send-btn svg {
      width: 18px;
      height: 18px;
    }

    /* ============ PROFILE PAGE ============ */
    #page-profile {
      min-height: 100vh;
    }

    .profile-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      height: var(--header-height);
      padding: 0 1.25rem;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-color);
    }

    .profile-header h2 {
      font-size: 1.15rem;
    }

    .profile-container {
      max-width: 560px;
      margin: 2rem auto;
      padding: 0 1.5rem;
    }

    .profile-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-xl);
      padding: 2rem;
    }

    .profile-email {
      font-size: 0.9rem;
      color: var(--text-muted);
      padding: 0.75rem 1rem;
      background: var(--bg-tertiary);
      border-radius: var(--radius-md);
      border: 1px solid var(--border-color);
      margin-bottom: 1.5rem;
    }

    .profile-email span {
      color: var(--text-secondary);
    }

    .profile-actions {
      display: flex;
      gap: 0.75rem;
      margin-top: 1.5rem;
    }

    /* ============ TOAST NOTIFICATIONS ============ */
    #toast-container {
      position: fixed;
      top: 1rem;
      right: 1rem;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .toast {
      padding: 0.85rem 1.25rem;
      border-radius: var(--radius-md);
      font-size: 0.9rem;
      font-weight: 500;
      color: var(--text-primary);
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      transform: translateX(120%);
      transition: transform 0.3s ease;
      max-width: 360px;
    }

    .toast--visible {
      transform: translateX(0);
    }

    .toast--success {
      border-left: 3px solid var(--success);
    }

    .toast--error {
      border-left: 3px solid var(--danger);
    }

    /* ============ LOADING SPINNER ============ */
    .page-loader {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      color: var(--text-muted);
    }

    /* ============ RESPONSIVE ============ */
    @media (max-width: 768px) {
      .hero h1 {
        font-size: 2.2rem;
      }

      .hero .subtitle {
        font-size: 1.05rem;
      }

      .features {
        grid-template-columns: 1fr;
        padding: 0 1.5rem 3rem;
      }

      .auth-card {
        padding: 1.75rem;
        margin: 0;
      }

      .form-row {
        grid-template-columns: 1fr;
        gap: 0;
      }

      .dashboard-header {
        padding: 0 0.75rem;
      }

      .dashboard-header-right .btn-label {
        display: none;
      }

      .chat-area {
        padding: 1rem 0.75rem;
      }

      .chat-input-bar {
        padding: 0.75rem;
      }

      .msg-bubble {
        max-width: 88%;
      }

      .profile-container {
        padding: 0 1rem;
      }

      .landing-nav {
        padding: 1rem;
      }
    }

    @media (max-width: 480px) {
      .hero h1 {
        font-size: 1.75rem;
      }

      .hero-cta {
        flex-direction: column;
        width: 100%;
        padding: 0 1rem;
      }

      .hero-cta .btn {
        width: 100%;
      }

      .nav-actions .btn {
        padding: 0.5rem 0.75rem;
        font-size: 0.85rem;
      }
    }
  </style>
</head>
<body>

  <!-- ============ TOAST CONTAINER ============ -->
  <div id="toast-container"></div>

  <!-- ============ PAGE: HOME ============ -->
  <div id="page-home" class="page" style="display:none;">
    <nav class="landing-nav">
      <div class="logo">Hotel Supply <span class="logo-accent">Pro</span></div>
      <div class="nav-actions">
        <a href="#login" class="btn btn-ghost">Accedi</a>
        <a href="#register" class="btn btn-primary">Registrati</a>
      </div>
    </nav>

    <section class="hero">
      <div class="hero-badge">Piattaforma B2B</div>
      <h1>La piattaforma intelligente per gli approvvigionamenti del tuo <span class="brand-text">hotel</span></h1>
      <p class="subtitle">Catalogo di oltre 9.000 prodotti da 6 fornitori selezionati</p>
      <p class="sub-detail">Ricerca intelligente, confronto prezzi e assistente AI dedicato</p>
      <div class="hero-cta">
        <a href="#register" class="btn btn-primary btn-lg">Registrati gratuitamente</a>
        <a href="#login" class="btn btn-secondary btn-lg">Accedi</a>
      </div>
    </section>

    <section class="features">
      <div class="feature-card">
        <div class="feature-icon">&#128218;</div>
        <h3>Catalogo Completo</h3>
        <p>Oltre 9.000 prodotti da 6 fornitori verificati, con prezzi aggiornati e dettagli completi.</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon">&#129302;</div>
        <h3>Assistente AI</h3>
        <p>Cerca prodotti, confronta prezzi e ottieni suggerimenti con il nostro assistente intelligente.</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon">&#128200;</div>
        <h3>Confronto Prezzi</h3>
        <p>Confronta i prezzi tra fornitori diversi per trovare le migliori offerte per il tuo hotel.</p>
      </div>
    </section>

    <footer class="landing-footer">
      &copy; 2025 Hotel Supply Pro. Tutti i diritti riservati.
    </footer>
  </div>

  <!-- ============ PAGE: LOGIN ============ -->
  <div id="page-login" class="page" style="display:none;">
    <div class="auth-container">
      <div class="auth-card">
        <div class="auth-header">
          <div class="logo">Hotel Supply <span class="logo-accent">Pro</span></div>
          <p>Accedi al tuo account</p>
        </div>

        <form id="login-form">
          <div class="form-group">
            <label class="form-label" for="login-email">Email</label>
            <input class="form-input" type="email" id="login-email" name="email" required autocomplete="email" placeholder="la-tua@email.com">
          </div>
          <div class="form-group">
            <label class="form-label" for="login-password">Password</label>
            <input class="form-input" type="password" id="login-password" name="password" required autocomplete="current-password" placeholder="La tua password">
          </div>
          <div class="form-error" id="login-error"></div>
          <button type="submit" class="btn btn-primary" style="width:100%; margin-top:0.5rem;">Accedi</button>
        </form>

        <div class="form-link">
          Non hai un account? <a href="#register">Registrati</a>
        </div>
      </div>
    </div>
  </div>

  <!-- ============ PAGE: REGISTER ============ -->
  <div id="page-register" class="page" style="display:none;">
    <div class="auth-container">
      <div class="auth-card auth-card--wide">
        <div class="auth-header">
          <div class="logo">Hotel Supply <span class="logo-accent">Pro</span></div>
          <p>Crea il tuo account gratuito</p>
        </div>

        <form id="register-form">
          <!-- Sezione: Accesso -->
          <div class="form-section-title">Accesso</div>
          <div class="form-group">
            <label class="form-label" for="reg-email">Email *</label>
            <input class="form-input" type="email" id="reg-email" name="email" required autocomplete="email" placeholder="la-tua@email.com">
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label" for="reg-password">Password *</label>
              <input class="form-input" type="password" id="reg-password" name="password" required minlength="6" autocomplete="new-password" placeholder="Minimo 6 caratteri">
            </div>
            <div class="form-group">
              <label class="form-label" for="reg-confirm-password">Conferma password *</label>
              <input class="form-input" type="password" id="reg-confirm-password" name="confirm_password" required autocomplete="new-password" placeholder="Ripeti la password">
            </div>
          </div>

          <!-- Sezione: Dati societari -->
          <div class="form-section-title">Dati societari</div>
          <div class="form-group">
            <label class="form-label" for="reg-company">Ragione sociale *</label>
            <input class="form-input" type="text" id="reg-company" name="company_name" required placeholder="Es. Hotel Roma S.r.l.">
          </div>
          <div class="form-group">
            <label class="form-label" for="reg-vat">Partita IVA *</label>
            <input class="form-input" type="text" id="reg-vat" name="vat_number" required placeholder="Es. IT01234567890">
          </div>

          <!-- Sezione: Informazioni Hotel -->
          <div class="form-section-title">Informazioni Hotel</div>
          <div class="form-group">
            <label class="form-label" for="reg-hotel">Nome hotel *</label>
            <input class="form-input" type="text" id="reg-hotel" name="hotel_name" required placeholder="Es. Grand Hotel Roma">
          </div>
          <div class="form-group">
            <label class="form-label" for="reg-address">Indirizzo</label>
            <input class="form-input" type="text" id="reg-address" name="hotel_address" placeholder="Es. Via Roma 1, 00100 Roma">
          </div>

          <!-- Sezione: Referente -->
          <div class="form-section-title">Referente</div>
          <div class="form-group">
            <label class="form-label" for="reg-contact">Nome e cognome *</label>
            <input class="form-input" type="text" id="reg-contact" name="contact_person" required placeholder="Es. Mario Rossi">
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label" for="reg-role">Ruolo</label>
              <input class="form-input" type="text" id="reg-role" name="contact_role" placeholder="Es. Responsabile acquisti">
            </div>
            <div class="form-group">
              <label class="form-label" for="reg-phone">Telefono</label>
              <input class="form-input" type="tel" id="reg-phone" name="phone" placeholder="Es. +39 333 1234567">
            </div>
          </div>

          <div class="form-error" id="register-error"></div>
          <button type="submit" class="btn btn-primary" style="width:100%; margin-top:0.5rem;">Crea Account</button>
        </form>

        <div class="form-link">
          Hai gi&agrave; un account? <a href="#login">Accedi</a>
        </div>
      </div>
    </div>
  </div>

  <!-- ============ PAGE: DASHBOARD ============ -->
  <div id="page-dashboard" class="page" style="display:none;">
    <header class="dashboard-header">
      <div class="dashboard-header-left">
        <div class="logo">Hotel Supply <span class="logo-accent">Pro</span></div>
        <div class="header-separator"></div>
        <div class="header-hotel-name" id="header-hotel-name"></div>
      </div>
      <div class="dashboard-header-right">
        <a href="#profile" class="btn btn-ghost" id="header-profile-btn" title="Profilo">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
          <span class="btn-label" id="header-contact-name"></span>
        </a>
        <button class="btn btn-ghost" id="new-chat-btn" title="Nuova chat">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M5 12h14"/></svg>
          <span class="btn-label">Nuova chat</span>
        </button>
        <button class="btn btn-ghost" id="logout-btn" title="Esci">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
          <span class="btn-label">Esci</span>
        </button>
      </div>
    </header>

    <div class="chat-area" id="chat-area">
      <div class="chat-messages" id="chat-messages"></div>
    </div>

    <div class="chat-input-bar">
      <div class="input-wrapper">
        <input type="text" id="chat-input" placeholder="Scrivi un messaggio..." autocomplete="off">
        <button class="chat-send-btn" id="chat-send-btn" title="Invia">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
        </button>
      </div>
    </div>
  </div>

  <!-- ============ PAGE: PROFILE ============ -->
  <div id="page-profile" class="page" style="display:none;">
    <header class="profile-header">
      <a href="#dashboard" class="btn btn-ghost" title="Torna alla chat">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
      </a>
      <h2>Il Mio Profilo</h2>
    </header>

    <div class="profile-container">
      <div class="profile-card">
        <div class="profile-email">
          Email: <span id="profile-email-display"></span>
        </div>

        <form id="profile-form">
          <div class="form-section-title">Dati societari</div>
          <div class="form-group">
            <label class="form-label" for="profile-company_name">Ragione sociale *</label>
            <input class="form-input" type="text" id="profile-company_name" name="company_name" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="profile-vat_number">Partita IVA *</label>
            <input class="form-input" type="text" id="profile-vat_number" name="vat_number" required>
          </div>

          <div class="form-section-title">Informazioni Hotel</div>
          <div class="form-group">
            <label class="form-label" for="profile-hotel_name">Nome hotel *</label>
            <input class="form-input" type="text" id="profile-hotel_name" name="hotel_name" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="profile-hotel_address">Indirizzo</label>
            <input class="form-input" type="text" id="profile-hotel_address" name="hotel_address">
          </div>

          <div class="form-section-title">Referente</div>
          <div class="form-group">
            <label class="form-label" for="profile-contact_person">Nome e cognome *</label>
            <input class="form-input" type="text" id="profile-contact_person" name="contact_person" required>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label" for="profile-contact_role">Ruolo</label>
              <input class="form-input" type="text" id="profile-contact_role" name="contact_role">
            </div>
            <div class="form-group">
              <label class="form-label" for="profile-phone">Telefono</label>
              <input class="form-input" type="tel" id="profile-phone" name="phone">
            </div>
          </div>

          <div class="profile-actions">
            <button type="submit" class="btn btn-primary">Salva modifiche</button>
            <a href="#dashboard" class="btn btn-secondary">Torna alla chat</a>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- ============ SUPABASE SDK ============ -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- ============ APPLICATION LOGIC ============ -->
  <script>
    /* ============================================================
       HOTEL SUPPLY PRO â€” Single-Page Application
       ============================================================ */

    // ============ CONFIGURATION ============
    const CONFIG = {
      SUPABASE_URL: 'https://wvlqjpmphfhkctupwvvd.supabase.co',
      SUPABASE_ANON_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind2bHFqcG1waGZoa2N0dXB3dnZkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA3MzMwNjIsImV4cCI6MjA4NjMwOTA2Mn0.Ov8iONgG-Ou4CuoMFBZ3S7WAlhHaEYrjiiE8u6z9MOg',
      N8N_WEBHOOK_URL: 'https://gabbo.app.n8n.cloud/webhook/b5092d51-dd56-49c7-9188-820052fd2ba4/chat',
      ROUTES: {
        home:      { page: 'page-home',      auth: false },
        login:     { page: 'page-login',     auth: false },
        register:  { page: 'page-register',  auth: false },
        dashboard: { page: 'page-dashboard', auth: true  },
        profile:   { page: 'page-profile',   auth: true  },
      },
      DEFAULT_ROUTE: 'home',
      AUTH_REDIRECT: 'dashboard',
      CHAT_TIMEOUT_MS: 30000,
    };

    // ============ SUPABASE CLIENT ============
    if (typeof window.supabase === 'undefined') {
      document.body.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100vh;color:#94a3b8;font-family:system-ui;">Errore di caricamento. Ricarica la pagina.</div>';
      throw new Error('Supabase SDK not loaded');
    }

    const sb = window.supabase.createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_ANON_KEY);

    // ============ APPLICATION STATE ============
    const state = {
      user: null,
      customer: null,
      sessionId: null,
      messages: [],
      isSending: false,
      initializing: true,
      pendingCustomerData: null,
    };

    // ============ AUTH ERROR TRANSLATIONS ============
    const AUTH_ERRORS = {
      'Invalid login credentials': 'Email o password non corretti.',
      'invalid_credentials': 'Email o password non corretti.',
      'Email not confirmed': 'Email non ancora confermata. Controlla la tua casella di posta.',
      'User already registered': 'Esiste gi\u00e0 un account con questa email.',
      'Password should be at least 6 characters': 'La password deve essere di almeno 6 caratteri.',
      'Signup requires a valid password': 'Inserisci una password valida.',
      'Email rate limit exceeded': 'Troppi tentativi. Riprova tra qualche minuto.',
      'default': 'Si \u00e8 verificato un errore. Riprova pi\u00f9 tardi.',
    };

    function translateAuthError(error) {
      if (!error) return AUTH_ERRORS['default'];
      return AUTH_ERRORS[error.message] || AUTH_ERRORS[error.code] || AUTH_ERRORS['default'];
    }

    // ============ UTILITY FUNCTIONS ============
    function $(selector) {
      return document.querySelector(selector);
    }

    function showToast(message, type) {
      type = type || 'info';
      var container = document.getElementById('toast-container');
      var toast = document.createElement('div');
      toast.className = 'toast toast--' + type;
      toast.textContent = message;
      container.appendChild(toast);
      requestAnimationFrame(function() {
        toast.classList.add('toast--visible');
      });
      setTimeout(function() {
        toast.classList.remove('toast--visible');
        toast.addEventListener('transitionend', function() {
          if (toast.parentNode) toast.remove();
        });
      }, 4000);
    }

    function setButtonLoading(btn, loading) {
      if (loading) {
        btn.dataset.originalText = btn.textContent;
        btn.textContent = 'Caricamento...';
        btn.disabled = true;
      } else {
        btn.textContent = btn.dataset.originalText || btn.textContent;
        btn.disabled = false;
      }
    }

    function escapeHtml(text) {
      var div = document.createElement('div');
      div.appendChild(document.createTextNode(text));
      return div.innerHTML;
    }

    function formatMessage(text) {
      if (!text) return '';
      var escaped = escapeHtml(text);
      // Bold
      escaped = escaped.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
      // Newlines
      escaped = escaped.replace(/\n/g, '<br>');
      return escaped;
    }

    // ============ AUTH MODULE ============
    var Auth = {
      async init() {
        var result = await sb.auth.getSession();
        var session = result.data.session;
        if (session) {
          state.user = session.user;
          await this.loadCustomer();
        }
        state.initializing = false;

        sb.auth.onAuthStateChange(async function(event, session) {
          if (event === 'SIGNED_IN' && session) {
            state.user = session.user;

            // Se c'e' un profilo in attesa (registrazione appena completata)
            if (state.pendingCustomerData) {
              var customerData = state.pendingCustomerData;
              state.pendingCustomerData = null;

              var insertResult = await sb
                .from('customers')
                .insert({
                  auth_user_id: session.user.id,
                  company_name: customerData.company_name,
                  vat_number: customerData.vat_number,
                  hotel_name: customerData.hotel_name,
                  hotel_address: customerData.hotel_address || null,
                  phone: customerData.phone || null,
                  contact_person: customerData.contact_person,
                  contact_role: customerData.contact_role || null,
                });

              if (insertResult.error) {
                console.error('Customer insert error:', insertResult.error);
                showToast('Errore nel salvataggio del profilo.', 'error');
              }
            }

            await Auth.loadCustomer();
            Router.navigate('dashboard');
          } else if (event === 'SIGNED_OUT') {
            state.user = null;
            state.customer = null;
            state.messages = [];
            state.sessionId = null;
            Router.navigate('home');
          }
        });
      },

      async loadCustomer() {
        if (!state.user) return;
        var result = await sb
          .from('customers')
          .select('*')
          .eq('auth_user_id', state.user.id)
          .single();
        if (result.data) {
          state.customer = result.data;
        }
      },

      async login(email, password) {
        var result = await sb.auth.signInWithPassword({ email: email, password: password });
        if (result.error) throw result.error;
        return result.data;
      },

      async register(email, password, customerData) {
        state.pendingCustomerData = customerData;
        var authResult = await sb.auth.signUp({ email: email, password: password });
        if (authResult.error) {
          state.pendingCustomerData = null;
          throw authResult.error;
        }
        return authResult.data;
      },

      async logout() {
        await sb.auth.signOut();
      },
    };

    // ============ ROUTER ============
    var Router = {
      init() {
        window.addEventListener('hashchange', function() {
          Router.handleRoute();
        });
        this.handleRoute();
      },

      navigate(route) {
        window.location.hash = '#' + route;
      },

      handleRoute() {
        if (state.initializing) return;

        var hash = window.location.hash.slice(1) || CONFIG.DEFAULT_ROUTE;
        var route = CONFIG.ROUTES[hash];

        if (!route) {
          this.navigate(CONFIG.DEFAULT_ROUTE);
          return;
        }

        // Auth guard: protected pages require login
        if (route.auth && !state.user) {
          this.navigate('login');
          return;
        }

        // Redirect logged-in users away from public auth pages
        if (state.user && (hash === 'login' || hash === 'register' || hash === 'home')) {
          this.navigate(CONFIG.AUTH_REDIRECT);
          return;
        }

        // Hide all pages
        var pages = document.querySelectorAll('.page');
        for (var i = 0; i < pages.length; i++) {
          pages[i].style.display = 'none';
        }

        // Show target page
        var target = document.getElementById(route.page);
        if (target) {
          target.style.display = '';
        }

        // Page-specific initialization
        if (hash === 'dashboard') {
          Chat.onEnter();
        } else if (hash === 'profile') {
          Profile.onEnter();
        }
      },
    };

    // ============ CHAT MODULE ============
    var Chat = {
      onEnter() {
        this.updateHeader();
        if (!state.sessionId) {
          this.newSession();
        }
        var input = document.getElementById('chat-input');
        if (input) {
          setTimeout(function() { input.focus(); }, 100);
        }
      },

      updateHeader() {
        var hotelEl = document.getElementById('header-hotel-name');
        var contactEl = document.getElementById('header-contact-name');
        if (state.customer) {
          if (hotelEl) hotelEl.textContent = state.customer.hotel_name || '';
          if (contactEl) contactEl.textContent = state.customer.contact_person || '';
        }
      },

      newSession() {
        state.sessionId = crypto.randomUUID();
        state.messages = [];
        this.clearChat();
        this.renderWelcome();
      },

      clearChat() {
        var chatMessages = document.getElementById('chat-messages');
        if (chatMessages) chatMessages.innerHTML = '';
      },

      renderWelcome() {
        var name = state.customer ? state.customer.contact_person : '';
        var firstName = name ? name.split(' ')[0] : '';
        var greeting = firstName ? ('Ciao ' + firstName + '!') : 'Ciao!';
        this.appendMessage('assistant', greeting + ' Sono il tuo assistente per gli acquisti.\n\nPosso aiutarti a cercare prodotti, confrontare prezzi e trovare le migliori offerte dai nostri fornitori. Cosa posso fare per te?');

        // Suggestion chips
        var suggestions = [
          'Che prosecco avete?',
          'Prodotti per la colazione',
          'Detersivi per la cucina',
          'Confronta prezzi Coca Cola',
        ];

        var chatMessages = document.getElementById('chat-messages');
        var chipsDiv = document.createElement('div');
        chipsDiv.className = 'suggestion-chips';
        chipsDiv.id = 'suggestion-chips';

        suggestions.forEach(function(text) {
          var chip = document.createElement('button');
          chip.className = 'suggestion-chip';
          chip.textContent = text;
          chip.addEventListener('click', function() {
            chipsDiv.remove();
            Chat.sendMessage(text);
          });
          chipsDiv.appendChild(chip);
        });

        chatMessages.appendChild(chipsDiv);
        this.scrollToBottom();
      },

      appendMessage(role, content) {
        var chatMessages = document.getElementById('chat-messages');
        var msg = document.createElement('div');
        msg.className = 'chat-message msg-' + role;

        var bubble = document.createElement('div');
        bubble.className = 'msg-bubble msg-bubble--' + role;
        bubble.innerHTML = formatMessage(content);

        msg.appendChild(bubble);
        chatMessages.appendChild(msg);
        this.scrollToBottom();

        state.messages.push({ role: role, content: content, timestamp: Date.now() });
      },

      showTyping() {
        var chatMessages = document.getElementById('chat-messages');
        var indicator = document.createElement('div');
        indicator.id = 'typing-indicator';
        indicator.className = 'chat-message msg-assistant';
        indicator.innerHTML = '<div class="msg-bubble msg-bubble--assistant typing-indicator"><span></span><span></span><span></span></div>';
        chatMessages.appendChild(indicator);
        this.scrollToBottom();
      },

      hideTyping() {
        var indicator = document.getElementById('typing-indicator');
        if (indicator) indicator.remove();
      },

      scrollToBottom() {
        var chatArea = document.getElementById('chat-area');
        if (chatArea) {
          chatArea.scrollTop = chatArea.scrollHeight;
        }
      },

      async sendMessage(text) {
        if (!text || !text.trim() || state.isSending) return;

        text = text.trim();

        // Remove suggestion chips
        var chips = document.getElementById('suggestion-chips');
        if (chips) chips.remove();

        // Show user message
        this.appendMessage('user', text);

        // Clear input
        var input = document.getElementById('chat-input');
        if (input) input.value = '';

        // Show typing
        state.isSending = true;
        this.updateSendButton();
        this.showTyping();

        // Prepare request with timeout
        var controller = new AbortController();
        var timeoutId = setTimeout(function() {
          controller.abort();
        }, CONFIG.CHAT_TIMEOUT_MS);

        try {
          var body = {
            chatInput: text,
            sessionId: state.sessionId,
            customerId: state.customer ? state.customer.id : (state.user ? state.user.id : ''),
            customerName: state.customer ? (state.customer.contact_person || '') : '',
            hotelName: state.customer ? (state.customer.hotel_name || '') : '',
            companyName: state.customer ? (state.customer.company_name || '') : '',
          };

          var response = await fetch(CONFIG.N8N_WEBHOOK_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(body),
            signal: controller.signal,
          });

          clearTimeout(timeoutId);

          if (!response.ok) {
            throw new Error('HTTP ' + response.status);
          }

          var data = await response.json();
          this.hideTyping();

          // Extract response text from various possible formats
          var reply;
          if (typeof data === 'string') {
            reply = data;
          } else if (data.output) {
            reply = data.output;
          } else if (data.text) {
            reply = data.text;
          } else if (data.response) {
            reply = data.response;
          } else if (data.message) {
            reply = data.message;
          } else {
            reply = JSON.stringify(data);
          }

          this.appendMessage('assistant', reply);

        } catch (err) {
          clearTimeout(timeoutId);
          this.hideTyping();
          var errorMsg = 'Mi dispiace, si \u00e8 verificato un errore di comunicazione. Riprova tra qualche istante.';
          if (err.name === 'AbortError') {
            errorMsg = 'La richiesta ha impiegato troppo tempo. Riprova con una domanda pi\u00f9 specifica.';
          }
          this.appendMessage('assistant', errorMsg);
          console.error('Chat error:', err);
        } finally {
          state.isSending = false;
          this.updateSendButton();
        }
      },

      updateSendButton() {
        var btn = document.getElementById('chat-send-btn');
        if (btn) btn.disabled = state.isSending;
      },

      bindEvents() {
        var input = document.getElementById('chat-input');
        var sendBtn = document.getElementById('chat-send-btn');
        var newChatBtn = document.getElementById('new-chat-btn');

        if (sendBtn) {
          sendBtn.addEventListener('click', function() {
            Chat.sendMessage(input.value);
          });
        }

        if (input) {
          input.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
              e.preventDefault();
              Chat.sendMessage(input.value);
            }
          });
        }

        if (newChatBtn) {
          newChatBtn.addEventListener('click', function() {
            Chat.newSession();
          });
        }
      },
    };

    // ============ PROFILE MODULE ============
    var Profile = {
      async onEnter() {
        if (!state.customer && state.user) {
          await Auth.loadCustomer();
        }
        this.populateForm();
      },

      populateForm() {
        var c = state.customer;
        if (!c) return;

        // Email (non-editable)
        var emailDisplay = document.getElementById('profile-email-display');
        if (emailDisplay && state.user) {
          emailDisplay.textContent = state.user.email || '';
        }

        // Editable fields
        var fields = ['company_name', 'vat_number', 'hotel_name', 'hotel_address', 'contact_person', 'contact_role', 'phone'];
        fields.forEach(function(field) {
          var input = document.getElementById('profile-' + field);
          if (input) {
            input.value = c[field] || '';
          }
        });
      },

      async save() {
        var form = document.getElementById('profile-form');
        var formData = new FormData(form);
        var updateData = {};

        for (var pair of formData.entries()) {
          updateData[pair[0]] = pair[1].trim() || null;
        }

        var btn = form.querySelector('button[type="submit"]');
        setButtonLoading(btn, true);

        try {
          var result = await sb
            .from('customers')
            .update(updateData)
            .eq('auth_user_id', state.user.id);

          if (result.error) throw result.error;

          // Update local state
          Object.assign(state.customer, updateData);
          showToast('Profilo aggiornato con successo!', 'success');
          Chat.updateHeader();
        } catch (err) {
          showToast('Errore nel salvataggio. Riprova.', 'error');
          console.error('Profile save error:', err);
        } finally {
          setButtonLoading(btn, false);
        }
      },

      bindEvents() {
        var form = document.getElementById('profile-form');
        if (form) {
          form.addEventListener('submit', function(e) {
            e.preventDefault();
            Profile.save();
          });
        }
      },
    };

    // ============ UI EVENT BINDINGS ============
    var UI = {
      bindEvents() {
        // Logout
        var logoutBtn = document.getElementById('logout-btn');
        if (logoutBtn) {
          logoutBtn.addEventListener('click', function() {
            Auth.logout();
          });
        }

        // Login form
        var loginForm = document.getElementById('login-form');
        if (loginForm) {
          loginForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            var email = document.getElementById('login-email').value;
            var password = document.getElementById('login-password').value;
            var errorEl = document.getElementById('login-error');
            var btn = loginForm.querySelector('button[type="submit"]');

            errorEl.textContent = '';
            setButtonLoading(btn, true);

            try {
              await Auth.login(email, password);
            } catch (err) {
              errorEl.textContent = translateAuthError(err);
            } finally {
              setButtonLoading(btn, false);
            }
          });
        }

        // Register form
        var registerForm = document.getElementById('register-form');
        if (registerForm) {
          registerForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            var errorEl = document.getElementById('register-error');
            var btn = registerForm.querySelector('button[type="submit"]');
            errorEl.textContent = '';

            var email = document.getElementById('reg-email').value.trim();
            var password = document.getElementById('reg-password').value;
            var confirmPassword = document.getElementById('reg-confirm-password').value;

            // Client-side validation
            if (password.length < 6) {
              errorEl.textContent = 'La password deve essere di almeno 6 caratteri.';
              return;
            }

            if (password !== confirmPassword) {
              errorEl.textContent = 'Le password non corrispondono.';
              return;
            }

            var customerData = {
              company_name: document.getElementById('reg-company').value.trim(),
              vat_number: document.getElementById('reg-vat').value.trim(),
              hotel_name: document.getElementById('reg-hotel').value.trim(),
              hotel_address: document.getElementById('reg-address').value.trim(),
              contact_person: document.getElementById('reg-contact').value.trim(),
              contact_role: document.getElementById('reg-role').value.trim(),
              phone: document.getElementById('reg-phone').value.trim(),
            };

            setButtonLoading(btn, true);

            try {
              await Auth.register(email, password, customerData);
              // If email confirmation is enabled, user is redirected to login
              // If not, onAuthStateChange will handle the redirect to dashboard
            } catch (err) {
              errorEl.textContent = translateAuthError(err);
            } finally {
              setButtonLoading(btn, false);
            }
          });
        }
      },
    };

    // ============ INITIALIZATION ============
    async function init() {
      try {
        await Auth.init();
      } catch (err) {
        console.error('Auth init error:', err);
      }

      Router.init();
      UI.bindEvents();
      Chat.bindEvents();
      Profile.bindEvents();
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
